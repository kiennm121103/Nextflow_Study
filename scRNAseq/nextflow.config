// Nextflow configuration file for single-cell RNA-seq pipeline

// Pipeline parameters
params {
    // Input/Output
    reads = "/home/kiennm/Nextflow_Study/scRNA_seq_data"
    output = "/home/kiennm/Nextflow_Study/scRNA_results"
    sample_sheet = "/home/kiennm/Nextflow_Study/scRNAseq/sample_sheet.csv"
    
    // Reference genome files
    genome_fasta = "/home/kiennm/Nextflow_Study/genome/genome.fa"
    gtf = "/home/kiennm/Nextflow_Study/genome/annotation/genes.gtf"
    transcriptome_index = "/home/kiennm/Nextflow_Study/genome/kallisto_index"
    
    // Technology parameters
    technology = "10X"              // Options: 10X, DropSeq, InDrop, CELSeq2
    chemistry = "auto"              // 10X chemistry: auto, SC3Pv2, SC3Pv3, SC5P-PE, SC5P-R2
    expect_cells = 3000             // Expected number of cells
    
    // Quality control thresholds
    min_genes = 200                 // Minimum genes per cell
    min_cells = 3                   // Minimum cells expressing a gene
    max_genes = 2500                // Maximum genes per cell (doublet filter)
    max_mito_pct = 5                // Maximum mitochondrial percentage
    
    // Analysis parameters
    n_top_genes = 2000              // Number of highly variable genes
    n_neighbors = 10                // Number of neighbors for graph construction
    n_pcs = 40                      // Number of principal components
    leiden_resolution = 0.5         // Leiden clustering resolution
}

// Process configuration
process {
    // Default settings
    cpus = 2
    memory = '4 GB'
    time = '2h'
    
    // Process-specific settings
    withName: FASTQC {
        cpus = 2
        memory = '4 GB'
    }
    
    withName: BUILD_KALLISTO_INDEX {
        cpus = 8
        memory = '16 GB'
        time = '2h'
    }
    
    withName: BUILD_STAR_INDEX {
        cpus = 8
        memory = '32 GB'
        time = '4h'
    }
    
    withName: KB_COUNT {
        cpus = 8
        memory = '16 GB'
        time = '4h'
    }
    
    withName: CELLRANGER_COUNT {
        cpus = 8
        memory = '64 GB'
        time = '8h'
    }
    
    withName: STARSOLO {
        cpus = 8
        memory = '32 GB'
        time = '4h'
    }
    
    withName: 'SCANPY_.*' {
        cpus = 4
        memory = '16 GB'
        time = '3h'
    }
    
    withName: FIND_MARKERS {
        cpus = 4
        memory = '16 GB'
        time = '2h'
    }
    
    withName: CELL_TYPE_ANNOTATION {
        cpus = 4
        memory = '16 GB'
        time = '2h'
    }
}

// Execution profiles
profiles {
    standard {
        process.executor = 'local'
    }
    
    conda {
        process.conda = 'bioconda::kb-python bioconda::fastqc bioconda::multiqc bioconda::scanpy bioconda::star'
        conda.enabled = true
    }
    
    docker {
        docker.enabled = true
        process {
            withName: 'KB_COUNT|BUILD_KALLISTO_INDEX' {
                container = 'quay.io/biocontainers/kb-python:0.27.3--pyhdfd78af_0'
            }
            withName: 'SCANPY_.*|FIND_MARKERS|CELL_TYPE_ANNOTATION' {
                container = 'quay.io/biocontainers/scanpy:1.9.3--pyhdfd78af_0'
            }
            withName: CELLRANGER_COUNT {
                container = '10xgenomics/cellranger:latest'
            }
            withName: 'BUILD_STAR_INDEX|STARSOLO' {
                container = 'quay.io/biocontainers/star:2.7.10b--h9ee0642_0'
            }
        }
    }
    
    singularity {
        singularity.enabled = true
        singularity.autoMounts = true
    }
}

// Report options
report {
    enabled = true
    file = "${params.output}/reports/report.html"
}

timeline {
    enabled = true
    file = "${params.output}/reports/timeline.html"
}

trace {
    enabled = true
    file = "${params.output}/reports/trace.txt"
}

dag {
    enabled = true
    file = "${params.output}/reports/dag.svg"
}

// Manifest
manifest {
    name = 'Single-Cell RNA-seq Analysis Pipeline'
    author = 'Your Name'
    description = 'Comprehensive single-cell RNA-seq data analysis from raw reads to cell type annotation'
    version = '1.0.0'
    nextflowVersion = '>=21.04.0'
}
